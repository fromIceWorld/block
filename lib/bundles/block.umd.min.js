!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("parse-html-template")):"function"==typeof define&&define.amd?define(["exports","parse-html-template"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).mark5={},e.parseHtmlTemplate)}(this,(function(e,t){"use strict";let n={bubbles:!1,cancelable:!0,composed:!0,detail:{}};class i{constructor(e,t={}){this.event=new CustomEvent(e,Object.assign(n,t))}emit(e){this.event.detail.hasOwnProperty("value")?this.event.detail.value=e:Object.defineProperty(this.event.detail,"value",{value:e,writable:!0}),this.event.detail.dom.dispatchEvent(this.event)}}function s(e){let t=["",null],n=e[0];if("#"==n)t=["id",e.substring(1)];else if("["==n){let[n,i]=e.substring(1,e.length-1).split("=");t=i?[n.trim(),i.trim()]:[n.trim(),null]}else t=["tagName",e];return t}class r{constructor(e,t,n){this.parse=e,this.instruction=t,this.instructionContext=n}transform(e){let{template:t}=e,n=this.parse.parse(t);this.instruction.createFactory(n);let i=Array.from(this.instruction.instructionParams).map((e=>this.instructionContext[e]));return this.instruction.componentDef(...i)}transformByTNodes(){}}var o,d,c,a;function l(t){let{selector:n,styles:i,providers:s}=t;return function(t){return t.selector=n,t.styles=i,t.providers=s,t.$type=e.Decorator.Directive,t}}function u(e){let{declarations:t,imports:n,exports:i,providers:s,bootstrap:r,routes:o}=e;return function(e){return e.$declarations=t,e.$imports=n,e.$exports=i,e.$providers=s,e.$bootstrap=r,e.$routes=o,e}}e.AttributeType=void 0,(o=e.AttributeType||(e.AttributeType={}))[o.dynamicStyle=0]="dynamicStyle",o[o.dynamicClass=1]="dynamicClass",o[o.staticAttribute=2]="staticAttribute",o[o.event=3]="event",o[o.dynamicAttrubute=4]="dynamicAttrubute",o[o.reference=5]="reference",o[o.structure=6]="structure",o[o.model=7]="model",o[o.style=8]="style",o[o.class=9]="class",o[o.text=10]="text",o[o.length=11]="length",e.elementType=void 0,(d=e.elementType||(e.elementType={}))[d.Element=1]="Element",d[d.Attr=2]="Attr",d[d.Text=3]="Text",d[d.CDATASection=4]="CDATASection",d[d.Comment=8]="Comment",e.TViewIndex=void 0,(c=e.TViewIndex||(e.TViewIndex={}))[c.Host=0]="Host",c[c.RootElements=1]="RootElements",c[c.LView=2]="LView",c[c.Class=3]="Class",c[c.Parent=4]="Parent",c[c.Children=5]="Children",c[c.Context=6]="Context",c[c.Document=7]="Document",c[c.Directives=8]="Directives",c[c.InRange=9]="InRange",c[c.ComponentDef=10]="ComponentDef",c[c.Slots=11]="Slots",c[c.Injector=12]="Injector",c[c.Module=13]="Module",c[c.TNode=14]="TNode",c[c.References=15]="References",c[c.EmbeddedView=16]="EmbeddedView",c[c.Structures=17]="Structures",c[c.Mode=18]="Mode",c[c.styleDOM=19]="styleDOM",e.Decorator=void 0,(a=e.Decorator||(e.Decorator={}))[a.Module=0]="Module",a[a.Component=1]="Component",a[a.Directive=2]="Directive";const h=Symbol("$$_@Inject_Token");function p(e){return function(t,n,i){t[h]||(t[h]=[]),t[h][i]=e}}const w=Symbol("$$_@Input_Keys"),x=Symbol("$$_@Input_Changes");function m(e){return function(t,n){t[w]||(t[w]=[]),t[w][n]=e}}const f=Symbol("$$_@Output_Keys"),V=Symbol("$$_@Output_Changes");const T=Symbol("$$_@View_Keys"),b=Symbol("$$_@View_Changes");const I=document;function y(e,t,...n){"[object Function]"=={}.toString.call(e[t])&&e[t](...n)}const v={};e.currentInjector=new class{get(e,t=v){if(t==v){const t=new Error(`NullInjectorError: No provider for ${e}`);throw t.name="NullInjectorError",t}return t}};class C{static create(t,n=e.currentInjector){let i=new g(t,"",n);return e.currentInjector=i,i}static"θθpro"(){return e.currentInjector}}C.THROW_IF_NOT_FOUND=v;class g{constructor(t=[],n="",i=e.currentInjector){this.parent=i,this.records=new Map,this._desc=n,t.forEach((e=>{let{token:t,useNew:n,fn:i,value:s,deps:r}=function(e){let{provide:t,useClass:n,useFactory:i,useValue:s,deps:r}=e;return{token:t,useNew:!(!n&&!i),fn:n||i,value:s,deps:r}}(e);this.records.set(t,{token:t,useNew:n,fn:i,value:s,deps:r})})),e.currentInjector=this}get(e,t){if(e["θθpro"])return e["θθpro"]();let n=this.records.get(e);return n?this.instanceOnlyProvider(n):this.parent.get(e,t)}instanceOnlyProvider(e){let{token:t,useNew:n,fn:i,value:s,deps:r}=e;if(s)return s;if(n&&i instanceof Function){let t=new Array;return r&&r.forEach((e=>{t.push(this.get(e))})),e.value=new i(...t)}throw`provider Error:${t} provider 格式错误`}}const $="$$_Bind_Module",O="$$_Register_Application",j="$$_Route_Config";class A{constructor(e){this.injector=e,this.application=this.injector.get(E)}bootstrapModule(e,t){let{$bootstrap:n,$routes:i}=e;n.length>0&&(this.application.registerModule(e),i&&this.application.registerRoutes(e),this.bootstrapComponent(n[0],this.application,t))}bootstrapComponent(e,t,n){let i=ae(e,n);t.rootTView=i,window.view=i}}class E{constructor(){this.modules=new Map,this.inRange=[],this.routesTree=new Map,this.routesStack=[this.routesTree],this.currentRouteBranch=this.routesTree}collectDeclarations(e){let{$declarations:t=[],$imports:n}=e,i=[...t];for(let e of n)i.push(...this.collectDeclarations(e));return i}resolveRoutes(e,t,n){for(let i of e){let e,{path:s,component:r,loadChildren:o,children:d=[]}=i,c=new Map,a=s.split("/"),l=[];for(let e of a)e.startsWith(":")?l.push("([^/]+)"):l.push(`${e}`);e=new RegExp([...n,...l].join("/")),t.set(e,c),c.set(j,{component:r,loadChildren:o}),this.resolveRoutes(d,c,[...n,...l])}return t}registerRoutes(e){let{$routes:t}=e;this.resolveRoutes(t,this.routesTree,[""]),this.currentRouteBranch=this.routesTree,console.log("解析后的route树：",this.routesTree)}registerModule(e){let{$declarations:t=[],$imports:n=[],$exports:i=[],$providers:r=[],$bootstrap:o=[]}=e;e[O]=this,this.collectAndRegisterProvider(e);for(let n of t){if(n.chooser=s(n.selector),n.hasOwnProperty($))throw Error("组件在多个模块中定义!");Object.defineProperty(n,$,{value:e,writable:!1,enumerable:!1}),this.inRange.push(n)}this.modules.set(e,{$declarations:t,$imports:n,$exports:i,$providers:r,$bootstrap:o});for(let e of n){let t=this.registerModule(e);this.inRange=[...this.inRange,...t]}return i}collectAndRegisterProvider(e){let{$providers:t=[]}=e;this.injector=new g(t,`${e.name}`)}}function M(e,t,n){let i=e.concat(n);return(e=[])=>i.concat(e)}function P(e){return e.get(A)}class D{clone(){}}class k extends D{constructor(t,n,i=[],s=[],r={},o={},d={},c={},a={},l={}){super(),this.type=e.elementType.Element,this.attributes=new Array,this.directives=[],this.children=[],this.parent=-1,this.tagName=t,this.index=n,this.attributes=[Object.values(i).map((e=>new Function(...e))),Object.values(s).map((e=>new Function(...e))),r,o,{},c,{},{},l],Object.keys(a).forEach((t=>this.attributes[e.AttributeType.structure][t]=new Function(...a[t]))),this.finAttributes=Object.assign({},r),Object.keys(d).map((t=>{this.attributes[e.AttributeType.dynamicAttrubute][t]=new Function(...d[t])}))}}class N extends D{constructor(t,n,i){super(),this.type=e.elementType.Text,this.parent=-1,this.content=t,this.native=n,this.index=i}}class R extends D{constructor(t,n){super(),this.type=e.elementType.Comment,this.parent=-1,this.content=t,this.native=n}}var S,F,_,L,H,B,G,K;e.ViewMode=void 0,(K=e.ViewMode||(e.ViewMode={}))[K.create=1]="create",K[K.update=2]="update",K[K.install=3]="install",K[K.sleep=4]="sleep";const U=20;class J extends Array{constructor(){super(),this[S]=[],this[F]=[],this[_]=new Set,this[L]={},this[H]=()=>this[e.TViewIndex.Module]&&this[e.TViewIndex.Module][O]?this[e.TViewIndex.Module][O].inRange||[]:this[e.TViewIndex.Parent][e.TViewIndex.InRange](),this[B]={},this[G]=e.ViewMode.sleep,Object.setPrototypeOf(this,J.prototype)}injectProviders(){var t;let n=(null===(t=Object.getOwnPropertyDescriptor(this[e.TViewIndex.Class],"providers"))||void 0===t?void 0:t.value)||[];this[e.TViewIndex.Injector]=new g(n)}updateInput(t){let n=this[e.TViewIndex.TNode]||new k("",1/0),{finAttributes:i}=n,s=t[w]||{},r=t[x],o=new Map;for(let[e,n]of Object.entries(s)){let s=i[n]||t[n],d=r[e]?r[e].currentValue:void 0;r[e]={inputKey:n,currentValue:s,previousValue:d},o.set(n,{currentValue:d,value:s})}return o}createOutput(t){if(!this[e.TViewIndex.TNode])return;let n=this[e.TViewIndex.Host],s=t[f]||{},r=t[V]=Object.create({});for(let[e,t]of Object.entries(s))r[e]={currentValue:new i(t,{detail:{dom:n}})}}createViewChild(e){let t=e[T]||{},n=e[b]=Object.create({});for(let[e,i]of Object.entries(t))n[e]={key:i}}mergeContextAndDecorators(e){for(let t of Object.getOwnPropertySymbols(e))for(let[n,i]of Object.entries(e[t]))Object.defineProperty(e,n,{get:()=>e[t][n].currentValue,set(e){throw Error(`%c${n}是被@Input,@Output,@Inject修饰的数据,不可更改!`)}})}initContext(){let t=this[e.TViewIndex.Class],n=new t(...(t[h]||[]).map((t=>{var n;return null===(n=this[e.TViewIndex.Injector])||void 0===n?void 0:n.get(t)})));return n[x]=Object.create({}),n[V]=Object.create({}),n[h]=[],n}}e.TViewIndex.Host,S=e.TViewIndex.RootElements,e.TViewIndex.TNode,e.TViewIndex.LView,e.TViewIndex.Parent,F=e.TViewIndex.Children,_=e.TViewIndex.Directives,e.TViewIndex.Class,L=e.TViewIndex.Context,e.TViewIndex.ComponentDef,e.TViewIndex.Slots,e.TViewIndex.Injector,e.TViewIndex.Module,H=e.TViewIndex.InRange,B=e.TViewIndex.References,e.TViewIndex.EmbeddedView,G=e.TViewIndex.Mode;class W extends Array{}class X extends J{constructor(t,n,i){super(),this.index=t,this.def=n,this.previousContext=[],this.childrenView=[],Object.setPrototypeOf(this,X.prototype);let s=this.currentTView=ue.currentTView(),r=s[e.TViewIndex.LView];this[e.TViewIndex.Host]=r[t+U],this[e.TViewIndex.Class]=i,this[e.TViewIndex.LView]=new W,this[e.TViewIndex.TNode]=s[t+U],this[e.TViewIndex.TNode].TView=this,this[e.TViewIndex.Module]=i.hasOwnProperty($)?i.$$_Bind_Module:null,this.injectProviders(),this[e.TViewIndex.Context]=this.currentTView[e.TViewIndex.Context],this[e.TViewIndex.EmbeddedView]=this.initContext()}install(){this.updateInput(this[e.TViewIndex.EmbeddedView]),this.createOutput(this[e.TViewIndex.EmbeddedView]),this.mergeContextAndDecorators(this[e.TViewIndex.EmbeddedView]),this.update()}update(){ue.pushContext(this),this.updateInput(this[e.TViewIndex.EmbeddedView]);let t=this[e.TViewIndex.EmbeddedView].OnInputChanges(this[e.TViewIndex.EmbeddedView][x]);this.diff(t.map((t=>Object.setPrototypeOf(t,this[e.TViewIndex.Context])))),ue.popContext()}diff(t){var n;for(let i=0;i<Math.max(t.length,this.previousContext.length);i++)if(!this.previousContext[i]&&t[i]){let n=new q(this.def,t[i],this[e.TViewIndex.Host]);n[e.TViewIndex.InRange]=this[e.TViewIndex.InRange],this.childrenView[i]=n,n.install(),this.previousContext[i]=t[i],this[e.TViewIndex.Host].after(...Array.from(n[e.TViewIndex.Host].childNodes)),this.childrenView[i][e.TViewIndex.Context]=t[i]}else this.previousContext[i]&&!t[i]?(this.childrenView[i].destroyed(),null===(n=this.previousContext)||void 0===n||n.splice(i,1),this.childrenView[i][e.TViewIndex.RootElements].map((t=>this.childrenView[i][e.TViewIndex.LView][t+U].remove())),this.childrenView[i]={}):this.previousContext[i]&&t[i]&&(this.childrenView[i][e.TViewIndex.Context]=t[i]||{},this.childrenView[i].update())}destroyed(){y(this[e.TViewIndex.Context],"OnDestroy"),this.diff([])}}class q extends J{constructor(t,n,i){super(),this.def=t,this.TView=ue.currentTView(),Object.setPrototypeOf(this,q.prototype),this[e.TViewIndex.Context]=n,this[e.TViewIndex.LView]=new W,this[e.TViewIndex.Host]=i}$getDefinition(){return this.def}install(){const t=this[e.TViewIndex.Children];ue.pushContext(this),this.def.template(e.ViewMode.install,this[e.TViewIndex.Context]);for(let e of t){this[e+U].TView.install()}ue.popContext()}update(){console.log("更新上下文",this[e.TViewIndex.Context]),ue.pushContext(this),this.def.template(e.ViewMode.update,this[e.TViewIndex.Context]);const t=this[e.TViewIndex.Children];for(let n of t){let t=this[n+U];t.TView[e.TViewIndex.Context]=this[e.TViewIndex.Context],t.TView.update()}ue.popContext()}destroyed(){ue.pushContext(this),this[e.TViewIndex.Directives];const t=this[e.TViewIndex.Children];for(let e of t){this[e+U].TView.destroyed()}ue.popContext()}}class z extends J{constructor(t,n,i,s){super(),this.index=t,Object.setPrototypeOf(this,z.prototype),this[e.TViewIndex.Class]=n,this[e.TViewIndex.TNode]=s,this[e.TViewIndex.Host]=i,this[e.TViewIndex.Module]=n.hasOwnProperty($)?n.$$_Bind_Module:null,this[e.TViewIndex.Parent]=ue.currentTView(),this.injectProviders(),this[e.TViewIndex.Context]=this.initContext()}install(){this.updateInput(this[e.TViewIndex.Context]),this.createOutput(this[e.TViewIndex.Context]),this.mergeContextAndDecorators(this[e.TViewIndex.Context])}update(){this.updateInput(this[e.TViewIndex.Context])}destroy(){}}class Z extends J{constructor(t,n,i=I.createElement("template").content){super(),this.$getDefinition=(()=>()=>{if(!this[e.TViewIndex.ComponentDef]){const t=this[e.TViewIndex.Injector].get(r);this[e.TViewIndex.ComponentDef]=t.transform(this[e.TViewIndex.Class])}return this[e.TViewIndex.ComponentDef]})(),Object.setPrototypeOf(this,Z.prototype),this[e.TViewIndex.Class]=t,this[e.TViewIndex.TNode]=n,this[e.TViewIndex.Host]=i,this[e.TViewIndex.LView]=new W,this[e.TViewIndex.Module]=t.hasOwnProperty($)?t.$$_Bind_Module:null,this[e.TViewIndex.Parent]=ue.currentTView(),this.injectProviders(),this[e.TViewIndex.Context]=this.initContext(),Y.runningTView=null}install(){this[e.TViewIndex.Mode]=e.ViewMode.install,this.updateInput(this[e.TViewIndex.Context]),this.createOutput(this[e.TViewIndex.Context]),this.createViewChild(this[e.TViewIndex.Context]),this.mergeContextAndDecorators(this[e.TViewIndex.Context]),ue.pushContext(this);const t=this.$getDefinition(),n=this[e.TViewIndex.Children],{styles:i}=this[e.TViewIndex.Class],s=document.createElement("style");s.innerHTML=i,document.head.append(s),this[e.TViewIndex.styleDOM]=s,console.log(t,i),t.template(e.ViewMode.install,this[e.TViewIndex.Context]),y(this[e.TViewIndex.Context],"OnInit");for(let e of n){this[e+U].TView.install()}y(this[e.TViewIndex.Context],"OnViewInit");const r=this[e.TViewIndex.Directives];for(let t of r){let n=this[t+U];for(let t of n.directives)y(t[e.TViewIndex.Context],"OnViewInit")}ue.popContext(),this[e.TViewIndex.Mode]=e.ViewMode.sleep}update(){this[e.TViewIndex.Mode]=e.ViewMode.update;const t=this.updateInput(this[e.TViewIndex.Context]);y(this[e.TViewIndex.Context],"OnInputChanges",t),ue.pushContext(this);let n=this.$getDefinition(),i=this[e.TViewIndex.Children];n&&n.template(e.ViewMode.update,this[e.TViewIndex.Context]),y(this[e.TViewIndex.Context],"OnUpdated",t);for(let e of i){this[e+U].TView.update()}y(this[e.TViewIndex.Context],"OnViewUpdated",t);const s=this[e.TViewIndex.Directives];for(let t of s){let n=this[t+U];for(let t of n.directives)y(t[e.TViewIndex.Context],"OnViewUpdated")}ue.popContext(),this[e.TViewIndex.Mode]=e.ViewMode.sleep}sleep(){console.log("该去休眠了")}destroyed(){var t;ue.pushContext(this);let n=this[e.TViewIndex.Children];for(let e of n){this[e+U].TView.destroyed()}y(this[e.TViewIndex.Context],"OnDestroy"),null===(t=this[e.TViewIndex.Host])||void 0===t||t.replaceChildren(),this[e.TViewIndex.styleDOM].remove(),ue.popContext()}}const Q=20;let Y={currentTView:null,rootTView:null,runningTView:null},ee=new Array;function te(){return Y.currentTView}function ne(e){Y.currentTView=e}function ie(){return te()[e.TViewIndex.LView]}function se(t,n){let i=te(),s=i[e.TViewIndex.LView],{tagName:r,finAttributes:o}=t,d=o.name,c=i[e.TViewIndex.Parent],a=I.createElement(r);for(;c instanceof X;)c=c[e.TViewIndex.Parent];if("slot"==r){let t=[],n=i[e.TViewIndex.Slots].map((t=>c[e.TViewIndex.LView][t+Q]));t=n.filter((t=>d&&t.nodeType==e.elementType.Element&&t.getAttribute("slot")==d||!d&&t.nodeType==e.elementType.Text)),a.append(...t)}t.native=a,s[Q+n]=a}function re(t){const n=te(),i=n[e.TViewIndex.LView],s=ee.pop(),r=i[s+Q],o=n[s+Q];let d=n[e.TViewIndex.RootElements];i[s+Q].localName==t&&0==ee.length&&d.push(s),o.directives.forEach((t=>{y(t[e.TViewIndex.Context],"OnInserted",r)})),o.TView&&(o.TView[e.TViewIndex.Slots]=o.children)}function oe(t,n,i,s){const r=te(),o=r[e.TViewIndex.LView],d=r[e.TViewIndex.Context];let c=o[t+Q],{tagName:a,type:l}=c;for(let[e,t]of Object.entries(i)){let e=d[t];"INPUT"==a?"text"==l?(c.value=e,s[t]=e):"checkbox"==l?Array.isArray(e)&&e.includes(c.value)?c.checked=!0:c.checked=!1:"radio"==l&&(c.checked=c.value===d[t]):"TEXT"==a||"TEXTAREA"==a?c.value=e:"SELECT"==a&&Array.from(c.options).forEach((t=>{e.includes(t.value)?t.selected=!0:t.selected=!1}))}}function de(e,t){const n=te(),{attributes:i}=te().$getDefinition(),[s,r,o,d,c,a,l,u]=i[t];let h=new k(e,t,s,r,o,d,c,a,l,u);return n[Q+t]=h,h}function ce(t){const n=te(),i=n[e.TViewIndex.LView],{nodeType:s}=i[t+Q];let r,o=n[e.TViewIndex.RootElements];0==ee.length?(r=-1,s==e.elementType.Text&&o.push(t)):r=ee[ee.length-1],s==e.elementType.Element&&ee.push(t),function(t,n){const i=te(),s=i[e.TViewIndex.LView];let r,o,d=i[n+Q];-1==t?o=i[e.TViewIndex.Host]:(r=i[t+Q],o="TEMPLATE"==s[t+Q].tagName?s[t+Q].content:s[t+Q],r.children.push(n),d.parent=t);r&&r.component||o.append(s[n+Q])}(r,t)}function ae(e,t){let n=window.root=new Z(e,void 0,t);return Y.rootTView=n,n.install(),n}class le{detectChanges(){Y.rootTView.update()}}const ue={elementStart:function(t,n){let i=de(t,n);se(i,n),function(e,t={}){Object.keys(t).forEach((n=>{e.setAttribute(n,t[n])}))}(i.native,i.attributes[e.AttributeType.staticAttribute]),function(t,n){let i=te(),s=i[e.TViewIndex.LView][n+Q],r=i[Q+n],{attributes:o,directives:d}=r;const c=i[e.TViewIndex.InRange]()||[],a=i[e.TViewIndex.Context],[,,l,,u,h,p]=o,w=Object.keys(h),x=a[b];Object.values(a[T]||{});const m=[];for(let[e,t]of Object.entries(a[T]||{}))w.includes(t)&&m.push(e);m.forEach((e=>{x[e].currentValue=s}));for(let o of c){let[c,a]=o.chooser;if("tagName"==c&&t==a||null===a&&(""===l[c]||u[c]||p[c])||l[c]===a){let{$type:c}=o;if(c==e.Decorator.Component){console.log("解析的router","router-view"==t),i[e.TViewIndex.Children].push(n),r.component=o,r.TView=new Z(r.component,r,s),m.forEach((e=>{e===o&&(x[e].currentValue=r.TView)}));break}if(c==e.Decorator.Directive){i[e.TViewIndex.Directives].add(n);let t=new z(n,o,s,r);m.forEach((e=>{e===o&&(x[e].currentValue=t)})),y(t[e.TViewIndex.Context],"OnBind",s),d.push(t);break}}}}(t,n),ce(n)},listener:function(e,t,n){ie()[n+Q].addEventListener(e,t)},elementEnd:re,updateProperty:function(t){let n=te(),i=n[t+Q],{attributes:s,finAttributes:r,directives:o}=i,[d,c,a,l,u,h,p,,w]=s;Object.keys(p).length>0?function(t,n,i){let s=te()[e.TViewIndex.Context];Object.keys(n).forEach((e=>{let t=n[e](s);i[e]=t}))}(0,p,r):(Object.keys(u).length>0&&function(t,n,i,s){let r=te(),o=r[e.TViewIndex.LView][t+Q],d=r[e.TViewIndex.Context];Object.keys(n).forEach((e=>{const t=n[e](d);o.setAttribute(e,t),i[e]=t})),oe(t,n,s,i)}(t,u,r,w),Object.keys(w).length>0&&oe(t,u,w,r),d.length>0&&function(t,n,i){let s=te(),r=ie()[t+Q],o=r.attributeStyleMap,d=s[e.TViewIndex.Context],c=Object.create({});n.forEach((e=>{Object.assign(c,e(d))}));for(let e of Object.keys(c))o.set(e,c[e]);i.style=r.getAttribute("style")}(t,d,r),c.length>0&&function(t,n,i){let s,r=te(),o=ie()[t+Q],d=r[e.TViewIndex.Context],c=o.getAttribute("class")||"",a=Object.create({}),l=[];c&&c.split(/[ ]+/).map((e=>{e.trim()&&(a[e]=!0)})),n.forEach((e=>{Object.assign(a,e(d))})),Object.keys(a).forEach((e=>{a[e]&&l.push(e)})),s=l.join(" "),o.setAttribute("class",s),i.class=s}(t,c,r),o.forEach((t=>{switch(n[e.TViewIndex.Mode]){case e.ViewMode.install:t.install(),y(t[e.TViewIndex.Context],"OnInit");break;case e.ViewMode.update:t.update(),y(t[e.TViewIndex.Context],"OnInputChanges")}})))},creatText:function(t){let n=te(),i=n[e.TViewIndex.LView],{attributes:s}=n.$getDefinition(),r=n[e.TViewIndex.Context],o=new Function(...s[t][e.AttributeType.text].content),d=I.createTextNode(o(r));i[Q+t]=d,n[Q+t]=new N(o,d,t),ce(t)},updateText:function(t){let n=te(),{content:i}=n[t+Q],s=n[e.TViewIndex.Context];ie()[t+Q].textContent=i(s)},createComment:function(t,n){let i=te(),s=i[e.TViewIndex.LView],r=I.createComment(n);return s[Q+t]=r,i[Q+t]=new R(n,r),ce(t),r},currentTView:te,setCurrentTView:ne,pushContext:function(t){t[e.TViewIndex.Parent]=te(),ne(t)},popContext:function(){ne(te()[e.TViewIndex.Parent])},embeddedViewStart:function(t,n,i){se(de(t,n),n),function(t,n){let i=te(),s=i[Q+t],{attributes:r}=s,o=!1,d=r[e.AttributeType.structure];const c=i[e.TViewIndex.InRange]();for(let s of c){let[r,c]=s.chooser;d[r]&&(o?delete d[r]:(o=!0,new X(t,n,s),i[e.TViewIndex.Children].push(t)))}}(n,i),ce(n)},embeddedViewEnd:function(e){re(e)}};let he=new Map;function pe(e){switch({}.toString.call(e)){case"[object Number]":case"[object String]":return e;case"[object Object]":return function(e){if(he.has(e))return he.get(e);let t={};return he.set(e,t),Object.keys(e).forEach((n=>{t[n]=pe(e[n])})),t}(e);case"[object Array]":return function(e){if(he.has(e))return he.get(e);let t=new Array;he.set(e,t);for(let n=0;n<e.length;n++)t[n]=pe(e[n]);return t}(e)}}class we{constructor(e={}){this.treeNode=[],this.index=0,this.configuration={interpolationSyntax:["{{","}}"],addAttributeMark:"&",addEventMark:"@",structureMark:"*",referenceMark:"#",modelMark:"%"},this.createFn="",this.updateFn="",this.elements=new Array,this.attributes=new Array,this.embeddedViews=[],this.instructionParams=new Set,this.configuration=Object.assign(this.configuration,e)}init(e){this.index=0,this.treeNode=e,this.createFn="",this.updateFn="",this.elements=[],this.attributes=[],this.embeddedViews=[],this.instructionParams.clear()}createFunctionBody(e=[]){this.init(e),this.resolveTNodes(this.treeNode)}createFactory(e=[]){this.createFunctionBody(e),this.createTemplateFn(),this.createComponentDef()}createComponentDef(){this.componentDef=new Function(...Array.from(this.instructionParams),`\n            let attributes = ${JSON.stringify(this.attributes)};\n            return {\n                embeddedViews:[${this.embeddedViews.length?this.embeddedViews.map((e=>{let{embeddedViews:t,attributes:n,template:i}=e;return`{\n                        embeddedViews:[${t.length?t.map((e=>`\n                                          {\n                                            embeddedViews: ${JSON.stringify(e.embeddedViews)},\n                                            attributes: ${JSON.stringify(e.attributes)},\n                                            template: ${e.template.toString()},\n                                        }`)).join(",\n"):""}],\n                        attributes:${JSON.stringify(n)},\n                        template:${i.toString()}\n                      }`})).join(",\n"):""}],\n                attributes,\n                template:${this.template}\n            }`)}createTemplateFn(){this.template=new Function("mode","ctx",`\n                if(mode & 1){ ${this.createFn}\n                };\n                if(mode & 2){ ${this.updateFn}\n                };\n            `)}resolveTNodes(t){for(let n of t){let{type:t}=n;switch(t){case e.elementType.Element:this.resolveElement(n);break;case e.elementType.Text:this.resolveText(n);break;case e.elementType.Comment:this.resolveComment(n)}}}resolveModel(e,t){let[n,i,s,r,o,d,c,a]=t;for(let[t,n]of Object.entries(a)){let{type:i}=s,r=t||"input";"input"==e?(this.instructionParams.add("listener"),this.createFn+="checkbox"==i?`\n                    listener('change',function($event){\n                                        if($event.target.checked){\n                                            ctx['${n}'].push($event.target.value)\n                                        }else{\n                                            ctx['${n}'].splice(ctx['${n}'].indexOf($event.target.value),1)\n                                        }\n                                        ctx.cd.detectChanges();\n                                    }, ${this.index});`:"radio"==i?`\n                    listener('change',function($event){\n                                        ctx['${n}'] = $event.target.value;\n                                        ctx.cd.detectChanges();\n                                    }, ${this.index});`:`\n                    listener('${r}',function($event){\n                                        ctx['${n}'] = $event.target.value;\n                                        ctx.cd.detectChanges();\n                                    }, ${this.index});`):"textarea"==e?this.createFn+=`\n                        listener('${r}',function($event){\n                                            ctx['${n}'] = $event.target.value;\n                                            ctx.cd.detectChanges();\n                                        }, ${this.index});`:"select"==e&&(this.createFn+=`\n                        listener('change',function($event){\n                                            ctx['${n}'] = [];\n                                            Array.from($event.target.options).forEach(item=>{\n                                                if(item.selected){\n                                                    ctx['${n}'].push(item.value)\n                                                }\n                                            })\n                                            ctx.cd.detectChanges();\n                                        }, ${this.index});`),this.updateFn+=`\n                    updateProperty(${this.index});`}}resolveElement(t){const{tagName:n,attributes:i,resolvedAttributes:s,children:r=[]}=t;s?this.attributes[this.index]=t.resolvedAttributes:(this.resolveAttributes(i),t.resolvedAttributes=this.attributes[this.index]),this.attemptUpdate();let[o,d,c,a,l,u,h,p]=t.resolvedAttributes;if(Object.keys(h).length){let n=pe(t);delete n.resolvedAttributes[e.AttributeType.structure][Object.keys(n.resolvedAttributes[e.AttributeType.structure])[0]],Object.entries(h).forEach((([e,t])=>{h[e.slice(1)]=t,delete h[e]})),this.resolveEmbedded(n),this.createFn+="\n                        embeddedViewEnd('template');",this.index++}else this.instructionParams.add("elementStart"),this.createFn+=`\n                        elementStart('${n}', ${this.index});`,Object.entries(a).forEach((([e,t])=>{this.addListener(e,t)})),this.resolveModel(n,t.resolvedAttributes),this.index++,this.resolveTNodes(r),this.closeElement(t)}resolveEmbedded(e){this.instructionParams.add("embeddedViewStart"),this.instructionParams.add("embeddedViewEnd"),this.createFn+=`\n                        embeddedViewStart('template', ${this.index}, this.embeddedViews[${this.embeddedViews.length}]);`;let t=new we;t.createFactory([e]);let n=Array.from(t.instructionParams),i=n.map((e=>ue[e])),s=t.componentDef(...i);this.instructionParams=new Set(Array.from(this.instructionParams).concat(n)),this.embeddedViews.push(s)}closeElement(e){this.instructionParams.add("elementEnd");let{tagName:t}=e;this.createFn+=`\n                        elementEnd('${t}');`}resolveText(t){this.attributes[this.index]=Array.from(new Array(e.AttributeType.length),(()=>Object.create(null))),this.instructionParams.add("creatText");let n=this.attributes[this.index][e.AttributeType.text],i=!1,[s,r]=this.configuration.interpolationSyntax,o=new RegExp(`${s}\\s*[a-zA-Z0-9!.'"\\[\\]]*\\s*${r}`,"g"),{content:d}=t;i=!!d.match(o),this.createFn+=`\n                        creatText(${this.index});`,i?(this.instructionParams.add("updateText"),n.content=["ctx",`with(ctx){\n                    return '${d.replace(o,(e=>"'+"+e.slice(s.length,e.length-r.length).trim()+"+'"))}'\n                }\n                `],this.updateFn+=`\n                        updateText(${this.index});`):n.content=["ctx",`return '${d}'\n            `],this.index++}resolveComment(e){this.instructionParams.add("createComment");let{content:t}=e;this.createFn+=`\n                        createComment(${this.index}, '${t}');`,this.index++}resolveAttributes(t){this.attributes[this.index]=Array.from(new Array(e.AttributeType.length),(()=>Object.create(null)));let[n,i,s,r,o,d,c,a]=this.attributes[this.index],{addAttributeMark:l,addEventMark:u,structureMark:h,referenceMark:p,modelMark:w}=this.configuration;for(let e=0;e<t.length;){let x=t[e][0];if("="==t[e+1]){switch(x){case l:let[d,p,,,x]=this.extractDynamiceAttributes(t[e].slice(1),t[e+2]);Object.assign(n,d),Object.assign(i,p),Object.assign(o,x);break;case h:c[t[e]]=["context",`with(context){\n                                return ${t[e+2]}\n                            }`];break;case u:r[t[e].slice(1)]=t[e+2];break;case w:a[t[e].slice(1)]=t[e+2];break;default:s[t[e]]=t[e+2]}e+=3}else{if(x===p)d[t[e].slice(1)]="";else s[t[e]]="";e++}}}attemptUpdate(){let[e,t,n,i,s,r,o]=this.attributes[this.index];(Object.keys(e).length>0||Object.keys(t).length>0||Object.keys(s).length>0||Object.keys(o).length>0)&&this.updateProperty()}extractDynamiceAttributes(t,n){let i=[{},{},{},{},{}],s=["context",`with(context){\n                    return ${n}\n                }`];switch(t){case"style":i[e.AttributeType.dynamicStyle][t]=s;break;case"class":i[e.AttributeType.dynamicClass][t]=s;break;default:i[e.AttributeType.dynamicAttrubute][t]=s}return i}updateProperty(){this.instructionParams.add("updateProperty"),this.updateFn+=`\n                        updateProperty(${this.index});`}addListener(e,t){this.instructionParams.add("listener");let[n,i=""]=t.replace(/[()]/g," ").split(" "),s=i.split(",").slice(1).map((e=>e.match(/^'[^']+'|"[^"]+"$/)?e:`ctx.${e}`)).join(",");console.log("event params",i),this.createFn+=`\n                        listener('${e}',function($event){\n                                            return ctx['${n}']($event,${s});\n                                        }, ${this.index});`}}class xe{constructor(e){this.fromControls=e,this.TView=ue.currentTView()}get(e){return this.fromControls[e]}change(){this.TView.update()}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function me(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o}function fe(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}let Ve=class{constructor(e){this.cd=e,console.log("formGroup 实例化")}OnBind(e){this.form=e}OnInit(){this.inputs=this.form.elements,Array.from(this.inputs).forEach((e=>{const t=e.getAttribute("formControlName")||"",n=this.formGroup.get(t);n&&n.bind(e,this)}))}change(){this.cd.detectChanges()}};var Te,be;me([m("formGroup"),fe("design:type",xe)],Ve.prototype,"formGroup",void 0),Ve=me([l({selector:"[formGroup]"}),(Te=0,be=p(le),function(e,t){be(e,t,Te)}),fe("design:paramtypes",[le])],Ve),e.formsModule=class{},e.formsModule=me([u({declarations:[Ve],exports:[]})],e.formsModule);const Ie=[{provide:A,deps:[C],useClass:A},{provide:Z,useValue:Z},{provide:X,useValue:X},{provide:r,deps:[t.parseTemplate,we,ue],useClass:r},{provide:we,deps:[],useClass:we},{provide:t.parseTemplate,deps:[],useClass:t.parseTemplate},{provide:ue,useValue:ue},{provide:C,deps:[],useClass:C},{provide:E,deps:[],useClass:E},{provide:le,deps:[],useClass:le}],ye=[{provide:I,useValue:I}];e.Application=E,e.CheckDetectChange=le,e.Component=function(t){let{selector:n,styles:i,template:s,providers:r}=t;return function(t){return t.selector=n,t.styles=i,t.template=s,t.providers=r,t.$type=e.Decorator.Component,t}},e.Directive=l,e.EventChanges=V,e.EventEmitter=i,e.EventKeys=f,e.Hook=y,e.Inject=p,e.InjectToken=h,e.InjectionToken=class{constructor(e){this.desc=e}},e.Injector=C,e.Input=m,e.InputChanges=x,e.InputKeys=w,e.Instruction=we,e.LogicView=W,e.Module=u,e.Output=function(e){return function(t,n){t[f]||(t[f]=Object.create({})),t[f][n]=e}},e.PlatformBrowserDynamic=function(e=[]){let t=M(Ie,0,ye),n=P(C.create(t(e)));return window.platformRef=n,n},e.PlatformRef=A,e.StaticInjector=g,e.TViewFns=ue,e.TemplateDirective=z,e.TemplateDynamic=J,e.TemplateEmbedded=class extends J{},e.TemplateView=Z,e.ViewChanges=b,e.ViewChild=function(e){return function(t,n){t[T]||(t[T]=Object.create({})),t[T][n]=e}},e.ViewContainer=X,e.ViewKeys=T,e.bootstrapView=ae,e.collectRunDependency=M,e.commentNode=R,e.compiler=r,e.componentFromModule=$,e.createPlatform=P,e.elementNode=k,e.embeddedView=q,e.formControl=class{constructor(e){this.config=e}bind(e,t){this.group=t,this.input=e,this.input.value=this.config.value,e.addEventListener("input",(()=>{this.config.value=e.value,console.log("formGroupDirective绑定的input更改",e.value),this.group.change()}))}},e.formGroup=xe,e.instructionIFrameStates=Y,e.offset=U,e.registerApplication=O,e.resolveSelector=s,e.routeConfig=j,e.textNode=N,Object.defineProperty(e,"__esModule",{value:!0})}));
